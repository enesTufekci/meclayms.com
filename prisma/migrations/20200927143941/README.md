# Migration `20200927143941`

This migration has been generated by Enes Tüfekçi at 9/27/2020, 4:39:41 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('USER', 'MAINTAINER', 'ADMIN', 'OWNER')

CREATE TYPE "public"."UserStatus" AS ENUM ('ACTIVE', 'SUSPENDED', 'TERMINATED')

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"username" text   NOT NULL ,
"password" text   NOT NULL ,
"role" "UserRole"  NOT NULL DEFAULT E'USER',
"status" "UserStatus"  NOT NULL DEFAULT E'ACTIVE',
"confirmed" boolean   NOT NULL DEFAULT false,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"refreshTokenIssueCount" integer   NOT NULL DEFAULT 0,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Invitation" (
"id" text   NOT NULL ,
"code" text   NOT NULL ,
"ownerId" text   ,
"consumerId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Topic" (
"id" text   NOT NULL ,
"slug" text   NOT NULL ,
"body" text   NOT NULL ,
"deleteReason" text   ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Entry" (
"id" text   NOT NULL ,
"body" text   NOT NULL ,
"topicId" text   ,
"userId" text   NOT NULL ,
"deleteReason" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntryRevision" (
"id" text   NOT NULL ,
"body" text   NOT NULL ,
"entryId" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntryCredit" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntryDiscredit" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Feedback" (
"id" text   NOT NULL ,
"body" text   NOT NULL ,
"entryId" text   NOT NULL ,
"userId" text   NOT NULL ,
"credited" boolean   NOT NULL DEFAULT false,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "Invitation_consumerId_unique" ON "public"."Invitation"("consumerId")

ALTER TABLE "public"."Invitation" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Invitation" ADD FOREIGN KEY ("consumerId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Topic" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Entry" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Entry" ADD FOREIGN KEY ("topicId")REFERENCES "public"."Topic"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."EntryRevision" ADD FOREIGN KEY ("entryId")REFERENCES "public"."Entry"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."EntryCredit" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntryDiscredit" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Feedback" ADD FOREIGN KEY ("entryId")REFERENCES "public"."Entry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Feedback" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200927143941
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,116 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum UserRole {
+  USER
+  MAINTAINER
+  ADMIN
+  OWNER
+}
+
+enum UserStatus {
+  ACTIVE
+  SUSPENDED
+  TERMINATED
+}
+
+model User {
+  id                     String           @id @default(uuid())
+  email                  String           @unique
+  username               String           @unique
+  password               String
+  role                   UserRole         @default(USER)
+  status                 UserStatus       @default(ACTIVE)
+  confirmed              Boolean          @default(false)
+  createdAt              DateTime         @default(now())
+  updatedAt              DateTime         @default(now())
+  refreshTokenIssueCount Int              @default(0)
+  Entry                  Entry[]
+  Topic                  Topic[]
+  EntryCredit            EntryCredit[]
+  EntryDiscredit         EntryDiscredit[]
+  OwnedInvitations       Invitation[]     @relation("owner")
+  UsedInvitation         Invitation       @relation("consumer")
+  Feedback               Feedback[]
+}
+
+model Invitation {
+  id         String   @id @default(uuid())
+  code       String
+  owner      User?    @relation(name: "owner", fields: [ownerId], references: [id])
+  ownerId    String?
+  consumer   User     @relation(name: "consumer", fields: [consumerId], references: [id])
+  consumerId String
+  createdAt  DateTime @default(now())
+}
+
+model Topic {
+  id           String    @id @default(uuid())
+  slug         String
+  body         String
+  entries      Entry[]
+  createdBy    User      @relation(fields: [userId], references: [id])
+  deleteReason String?
+  userId       String
+  createdAt    DateTime  @default(now())
+  updatedAt    DateTime  @default(now())
+  deletedAt    DateTime?
+}
+
+model Entry {
+  id           String          @id @default(uuid())
+  body         String
+  createdBy    User            @relation(fields: [userId], references: [id])
+  Topic        Topic?          @relation(fields: [topicId], references: [id])
+  topicId      String?
+  userId       String
+  revisions    EntryRevision[]
+  deleteReason String?
+  createdAt    DateTime        @default(now())
+  updatedAt    DateTime        @default(now())
+  deletedAt    DateTime?
+  Feedback     Feedback[]
+}
+
+model EntryRevision {
+  id        String    @id @default(uuid())
+  body      String
+  Entry     Entry?    @relation(fields: [entryId], references: [id])
+  entryId   String?
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now())
+  deletedAt DateTime?
+}
+
+model EntryCredit {
+  id      String @id @default(uuid())
+  givenBy User   @relation(fields: [userId], references: [id])
+  userId  String
+}
+
+model EntryDiscredit {
+  id      String @id @default(uuid())
+  givenBy User   @relation(fields: [userId], references: [id])
+  userId  String
+}
+
+model Feedback {
+  id        String   @id @default(uuid())
+  body      String
+  entry     Entry    @relation(fields: [entryId], references: [id])
+  givenBy   User     @relation(fields: [userId], references: [id])
+  entryId   String
+  userId    String
+  credited  Boolean  @default(false)
+  createdAt DateTime @default(now())
+  deletedAt DateTime @default(now())
+}
```


